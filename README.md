# README

`With the help of ChatGPT`

## 1. 概要
本アプリケーションは、ローカルに保存された HDF5 形式ファイル（拡張子 `.hdf5`）を可視化・解析するためのウェブアプリケーションです。アプリ上では HDF5 ファイル内部の階層構造をツリー表示し、各データセットの形状・型情報・可視化などをインタラクティブに操作できます。さらに、1次元または2次元のデータについては CSV 形式でエクスポート可能です。



## 2. 起動方法
本アプリは主に以下の2通りの方法で起動可能です。

1. **AppManagerから起動**
  - AppManagerと同じ階層にcloneしてください
  - 起動方法は[AppManager](https://github.com/ishizawa2468/AppManagerForStreamlit?tab=readme-ov-file#%E6%A6%82%E8%A6%81)で確認してください

2. **ターミナル（コマンドライン）から直接起動**
  - 必要なライブラリを持った仮想環境を準備したうえで、次のいずれかのコマンドを実行してください。
    ```bash
    python main.py
    ```
    または
    ```bash
    streamlit run home.py
    ```
  - 成功するとブラウザ上でアプリが開き、HDF5 ファイルのパス入力やツリー表示などが行えます。



## 3. デモ
アプリの操作例をご確認いただく場合は、本リポジトリの `docs` ディレクトリに配置されている `demo.mp4` をダウンロードしてご覧ください。一連の操作手順を把握するのにお役立ていただけます。

![デモ動画](docs/demo.gif)

## 4. アプリの主な目的・機能概要
このアプリでは、研究開発やデータ解析でよく使用される HDF5 ファイルの内容を、GUI 上で効率的に確認できる環境を提供します。主な機能は以下のとおりです。

- **HDF5ファイルパス管理**
  - ファイルパスの入力・検証
  - テンプレート（よく使用するファイルパス）の登録・削除

- **HDF5構造のツリー表示**
  - グループ・データセットを階層的に表示
  - 選択したノードの詳細確認

- **データセットの可視化・エクスポート**
  - メタ情報（データ型、形状など）の確認
  - 0次元～3次元データの可視化（Matplotlib）
  - 1次元・2次元データの CSV ダウンロード
    - 3次元データも各Frameずつでダウンロード可能。ボタンは無いのでStreamlitの表示機能を使ってください。



## 5. コード構成
本アプリは大きく以下のファイルに分割されています。

1. **home.py**
  - Streamlit アプリのエントリーポイントです。
  - ページ全体の構成やテンプレートパス管理、ファイルパス検証、ツリー表示・可視化を統括します。
  - `streamlit_antd_components.tree` を用いてツリーを生成し、ユーザの選択に応じてデータを表示します。

2. **HDFTreeHandler.py**
  - HDF5 ファイルを読み込んで階層構造を解析し、ツリー表示用に整形します。
  - 再帰的に HDF5 内を探索し、グループやデータセットを階層構造として保持します。

3. **template_paths.json**
  - 登録された HDF5 ファイルパスのテンプレートを保持するファイルです。
  - 新規登録や削除時に自動で更新されます。



## 6. メイン処理のフロー
以下に本アプリの大まかな流れを示します。

1. **Streamlit 設定の初期化**
  - ページタイトルやレイアウトを設定し、アプリの見出しを表示します。

2. **テンプレートパスの表示・管理**
  - 登録済みのテンプレートパス一覧を表示し、削除操作などを行えます。
  - 新規テンプレートパスも入力・登録可能です。

3. **HDF5 ファイルパスの取得・検証**
  - ユーザが入力したファイルパスを `h5py.is_hdf5()` でチェックします。
  - HDF5 ファイルであれば次のステップへ進みます。

4. **ツリー構造の生成・表示**
  - `HDFTreeHandler` を用いて HDF5 内部を解析し、グループ・データセットをツリー表示します。
  - 選択したノードのフルパスを取得し、データセットを特定します。

5. **データセットの可視化・ダウンロード**
  - 選択ノードがデータセットの場合、その詳細情報（`shape`, `dtype` など）を表示し、次元に応じたグラフを描画します。
  - 1次元・2次元データは CSV としてダウンロードできます。



## 7. 技術的工夫と利点
- **ツリー表示への `streamlit_antd_components` 活用**  
  Ant Design コンポーネントを利用することで、HDF5 の階層構造をわかりやすいツリー形式で表示し、ノード選択に合わせた操作を容易にしています。

- **テンプレートパス管理**  
  よく使用する HDF5 ファイルパスをテンプレートとして登録できるため、ファイル読み込み作業の効率化に寄与します。

- **多次元データの簡易プロット**  
  0次元（スカラー値）から 3次元データまで対応し、最低限の可視化機能を備えています。4次元以上のデータについては、今後の拡張を見据えた実装です。

- **軽量な CSV エクスポート**  
  `io.StringIO` などを用いてファイル生成せずに即座にダウンロードできるため、大規模データでもスムーズなエクスポートが可能です。



## 8. HDFTreeHandler クラスについて
`HDFTreeHandler` クラスは、HDF5 ファイルを再帰的に探索してツリー構造を生成するコア機能を提供します。

- **クラス概要**
  - コンストラクタで受け取った HDF5 ファイルパスからファイルを読み込み、階層構造を辞書としてまとめます。
  - `get_treeitems()` メソッドを通じて、Streamlit のツリー表示用コンポーネントに適した `TreeItem` リストを返却します。

- **データ構造**
  - 再帰的に子要素を走査し、グループとデータセットを区別して保持します。
  - データセットの場合はフルパスを `path` として記録し、後続の可視化やダウンロード処理に活用します。
